<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµŒè·¯åº§æ¨™æ¸¬å®šãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        h1 {
            margin-bottom: 20px;
            color: #FFD700;
        }
        .info {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        .path-input {
            margin-bottom: 10px;
        }
        .path-input label {
            display: inline-block;
            width: 120px;
            color: #FFD700;
        }
        .path-input input {
            background: #333;
            border: 1px solid #666;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .coordinates {
            margin-top: 10px;
            font-size: 18px;
            color: #4CAF50;
        }
        .image-container {
            position: relative;
            display: inline-block;
            cursor: crosshair;
            border: 2px solid #FFD700;
        }
        .image-container img {
            display: block;
            max-width: 100%;
            height: auto;
        }
        .image-container svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FF0000;
            border: 2px solid #FFFFFF;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10;
        }
        .label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
        }
        .saved-coords {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .saved-coords h2 {
            margin-bottom: 15px;
            color: #FFD700;
        }
        .coord-list {
            font-family: monospace;
            font-size: 12px;
            line-height: 1.8;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        button.reset {
            background: #f44336;
        }
        button.reset:hover {
            background: #da190b;
        }
        button.finish {
            background: #2196F3;
        }
        button.finish:hover {
            background: #0b7dda;
        }
        .instructions {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        .instructions ol {
            margin-left: 20px;
            line-height: 1.8;
        }
        .current-path {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¤ï¸ çµŒè·¯åº§æ¨™æ¸¬å®šãƒ„ãƒ¼ãƒ«</h1>

        <div class="instructions">
            <h3>ä½¿ã„æ–¹</h3>
            <ol>
                <li>çµŒè·¯åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šqf0, sf0ãªã©ï¼‰</li>
                <li>ç™½ç·šã«æ²¿ã£ã¦çµŒç”±ç‚¹ã‚’é †ç•ªã«ã‚¯ãƒªãƒƒã‚¯ï¼ˆå‡ºç™ºâ†’çµŒç”±â†’åˆ°ç€ï¼‰</li>
                <li>çµŒè·¯ãŒå®Œæˆã—ãŸã‚‰ã€Œâœ… çµŒè·¯å®Œäº†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>æ¬¡ã®çµŒè·¯åã‚’å…¥åŠ›ã—ã¦ç¹°ã‚Šè¿”ã—</li>
                <li>å…¨ã¦å®Œäº†ã—ãŸã‚‰ã€ŒğŸ“‹ å…¨çµŒè·¯ã‚’ã‚³ãƒ”ãƒ¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            </ol>
            <p style="margin-top: 10px; color: #FFD700;">â€» ç›´ç·šåŒºé–“ã®ä¸¡ç«¯ã¨ã€æ›²ãŒã‚Šè§’ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
        </div>

        <div class="info">
            <div class="path-input">
                <label>ç¾åœ¨ã®çµŒè·¯:</label>
                <input type="text" id="pathName" placeholder="ä¾‹: qf0" value="qf0">
            </div>
            <div>ãƒã‚¦ã‚¹ä½ç½®: <span id="current-coords">-</span></div>
            <div class="coordinates">
                ç¾åœ¨ã®çµŒè·¯: <span class="current-path" id="current-path">æœªè¨­å®š</span>
                (<span id="point-count">0</span>ç‚¹)
            </div>
            <div style="margin-top: 10px;">
                <button class="finish" onclick="finishCurrentPath()">âœ… çµŒè·¯å®Œäº†</button>
                <button class="reset" onclick="resetCurrentPath()">ğŸ”„ ç¾åœ¨ã®çµŒè·¯ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                <button onclick="copyAllPaths()">ğŸ“‹ å…¨çµŒè·¯ã‚’ã‚³ãƒ”ãƒ¼ (%)</button>
                <button class="reset" onclick="resetAll()">ğŸ—‘ï¸ å…¨ã¦ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>

        <div class="image-container" id="imageContainer">
            <img src="/Tournament_4K.png" id="tournamentImage" alt="Tournament">
            <svg id="pathSvg"></svg>
        </div>

        <div class="saved-coords">
            <h2>è¨˜éŒ²ã•ã‚ŒãŸçµŒè·¯</h2>
            <div class="coord-list" id="coordList">çµŒè·¯ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„...</div>
        </div>
    </div>

    <script>
        const IMAGE_WIDTH = 3840;
        const IMAGE_HEIGHT = 2160;

        let allPaths = {};  // å…¨çµŒè·¯ã‚’ä¿å­˜
        let currentPoints = [];  // ç¾åœ¨ã®çµŒè·¯ã®ãƒã‚¤ãƒ³ãƒˆ
        let currentPathName = '';

        const imageContainer = document.getElementById('imageContainer');
        const image = document.getElementById('tournamentImage');
        const pathSvg = document.getElementById('pathSvg');
        const currentCoordsDisplay = document.getElementById('current-coords');
        const currentPathDisplay = document.getElementById('current-path');
        const pointCountDisplay = document.getElementById('point-count');
        const coordListDisplay = document.getElementById('coordList');
        const pathNameInput = document.getElementById('pathName');

        // ç¾åœ¨ã®çµŒè·¯åã‚’æ›´æ–°
        pathNameInput.addEventListener('input', () => {
            currentPathName = pathNameInput.value;
            updateCurrentPathDisplay();
        });

        // åˆæœŸå€¤è¨­å®š
        currentPathName = pathNameInput.value;
        updateCurrentPathDisplay();

        // ãƒã‚¦ã‚¹ç§»å‹•ã§åº§æ¨™è¡¨ç¤ºï¼ˆ%ã‚‚è¡¨ç¤ºï¼‰
        imageContainer.addEventListener('mousemove', (e) => {
            const rect = image.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const xPercent = ((x / rect.width) * 100).toFixed(2);
            const yPercent = ((y / rect.height) * 100).toFixed(2);
            currentCoordsDisplay.textContent = `x: ${Math.round(x)}px (${xPercent}%), y: ${Math.round(y)}px (${yPercent}%)`;
        });

        // ã‚¯ãƒªãƒƒã‚¯ã§åº§æ¨™è¨˜éŒ²
        imageContainer.addEventListener('click', (e) => {
            if (!currentPathName) {
                alert('çµŒè·¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const rect = image.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // %ã«å¤‰æ›
            const xPercent = parseFloat(((x / rect.width) * 100).toFixed(2));
            const yPercent = parseFloat(((y / rect.height) * 100).toFixed(2));

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            const marker = document.createElement('div');
            marker.className = 'marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.dataset.pathId = 'current';
            imageContainer.appendChild(marker);

            // ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
            const label = document.createElement('div');
            label.className = 'label';
            label.textContent = `${currentPoints.length + 1}`;
            label.style.left = (x + 10) + 'px';
            label.style.top = (y - 10) + 'px';
            label.dataset.pathId = 'current';
            imageContainer.appendChild(label);

            // åº§æ¨™ã‚’ä¿å­˜
            currentPoints.push({ x: xPercent, y: yPercent });
            pointCountDisplay.textContent = currentPoints.length;

            // SVGãƒ‘ã‚¹ã‚’æ›´æ–°
            updateSvgPath();
        });

        function updateCurrentPathDisplay() {
            currentPathDisplay.textContent = currentPathName || 'æœªè¨­å®š';
        }

        function updateSvgPath() {
            if (currentPoints.length < 2) {
                pathSvg.innerHTML = '';
                return;
            }

            const rect = image.getBoundingClientRect();
            let pathD = '';

            currentPoints.forEach((point, index) => {
                const x = (point.x / 100) * rect.width;
                const y = (point.y / 100) * rect.height;

                if (index === 0) {
                    pathD = `M ${x} ${y}`;
                } else {
                    pathD += ` L ${x} ${y}`;
                }
            });

            pathSvg.innerHTML = `<path d="${pathD}" stroke="#FF0000" stroke-width="3" fill="none" opacity="0.7"/>`;
        }

        function finishCurrentPath() {
            if (!currentPathName) {
                alert('çµŒè·¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (currentPoints.length < 2) {
                alert('æœ€ä½2ç‚¹ä»¥ä¸Šå¿…è¦ã§ã™');
                return;
            }

            // çµŒè·¯ã‚’ä¿å­˜
            allPaths[currentPathName] = [...currentPoints];

            // ç¾åœ¨ã®çµŒè·¯ã‚’ã‚¯ãƒªã‚¢
            currentPoints = [];
            pointCountDisplay.textContent = '0';

            // ãƒãƒ¼ã‚«ãƒ¼ã¨ãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤
            const markers = imageContainer.querySelectorAll('[data-path-id="current"]');
            markers.forEach(marker => marker.remove());

            // SVGã‚’ã‚¯ãƒªã‚¢
            pathSvg.innerHTML = '';

            // æ¬¡ã®çµŒè·¯åã‚’ææ¡ˆ
            const nextPath = suggestNextPath(currentPathName);
            pathNameInput.value = nextPath;
            currentPathName = nextPath;
            updateCurrentPathDisplay();

            // ä¿å­˜ã•ã‚ŒãŸçµŒè·¯ã‚’è¡¨ç¤º
            updateCoordinatesList();

            alert(`çµŒè·¯ã€Œ${Object.keys(allPaths)[Object.keys(allPaths).length - 1]}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\næ¬¡ã®çµŒè·¯: ${nextPath}`);
        }

        function suggestNextPath(current) {
            // æ¬¡ã®çµŒè·¯ã‚’è‡ªå‹•ææ¡ˆ
            const match = current.match(/^([a-z]+)(\d+)$/);
            if (match) {
                const prefix = match[1];
                const num = parseInt(match[2]);
                return `${prefix}${num + 1}`;
            }
            return '';
        }

        function resetCurrentPath() {
            if (confirm('ç¾åœ¨ã®çµŒè·¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                currentPoints = [];
                pointCountDisplay.textContent = '0';

                const markers = imageContainer.querySelectorAll('[data-path-id="current"]');
                markers.forEach(marker => marker.remove());

                pathSvg.innerHTML = '';
            }
        }

        function resetAll() {
            if (confirm('å…¨ã¦ã®çµŒè·¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                allPaths = {};
                currentPoints = [];
                pointCountDisplay.textContent = '0';

                const markers = imageContainer.querySelectorAll('.marker, .label');
                markers.forEach(marker => marker.remove());

                pathSvg.innerHTML = '';
                updateCoordinatesList();
            }
        }

        function updateCoordinatesList() {
            if (Object.keys(allPaths).length === 0) {
                coordListDisplay.textContent = 'çµŒè·¯ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„...';
                return;
            }

            let html = '<pre style="color: #4CAF50;">export const MATCH_PATHS = {\n';

            Object.entries(allPaths).forEach(([pathName, points], index) => {
                html += `  '${pathName}': [\n`;
                points.forEach((point, pIndex) => {
                    html += `    { x: ${point.x}, y: ${point.y} }${pIndex < points.length - 1 ? ',' : ''}\n`;
                });
                html += `  ]${index < Object.keys(allPaths).length - 1 ? ',' : ''}\n`;
            });

            html += '};</pre>';

            coordListDisplay.innerHTML = html;
        }

        function copyAllPaths() {
            if (Object.keys(allPaths).length === 0) {
                alert('çµŒè·¯ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            let text = 'export const MATCH_PATHS = {\n';

            Object.entries(allPaths).forEach(([pathName, points], index) => {
                text += `  '${pathName}': [\n`;
                points.forEach((point, pIndex) => {
                    text += `    { x: ${point.x}, y: ${point.y} }${pIndex < points.length - 1 ? ',' : ''}\n`;
                });
                text += `  ]${index < Object.keys(allPaths).length - 1 ? ',' : ''}\n`;
            });

            text += '};';

            navigator.clipboard.writeText(text).then(() => {
                alert('å…¨çµŒè·¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }).catch(() => {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
            });
        }
    </script>
</body>
</html>
